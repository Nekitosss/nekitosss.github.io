---
layout: post
title: Lets dive into AWS
subtitle: What if you need a server?
tags: [aws, backend, administration]
comments: true
---

![AWS Header](/img/2021-03/aws_iam/header_image.jpg){: .center-image }

Когда разрабатываешь своё indie приложение, непременно сталкиваешься с необходимостью наличия серверной бд и какой никакой backend логики. Первыми и простыми решениями будет использовать фреймворки Cloid Kit (Apple) или Firebase (Google). Они покрывают многие кейсы, но не предоставляют гибкой настройки, если нужно что-то уровнем больше, чем примитивное.

Тут в дело вступают провайдеры облачных серверов. Сейчас их довольно много, но самым популярным остаётся Amazon AWS. Платформа всё в одном, которая предоставляет огромное количество сервисов для разработки. Я думал, что будет просто начать всё это использовать, но необходимый уровень знаний, требующихся для настройки стэка, оказался выше, чем у меня был на момент начала работы (да и на текущий). Поэтому давайте разберёмся вместе, как поднять свой собственный стэк с сервером, базой данных, купить домен и подключить его и как начать пользоваться имеющимся многообразием облачных технологий.

![AWS Services](/img/2021-03/aws_iam/aws_services.png){: .center-image }

Поначалу глаза разбегаются в попытках охватить все возможноные варианты использования AWS. На скриншоте выше только треть из имеющихся. И не сразу понятно, какой сервис за что отвечает. Примерный стэк, который мы будем использовать и что мы будем строить:
1. iAM - сервис для авторизации и доступов
2. VPC - настройка приватный сетей
3. RDS - хостинг баз данных
4. EC2 - виртуальная машина в облаке
5. Route53 - работа с доменными именами (как внешняя, так и внутренняя)
6. ECR - хранение образов докера для деплоя на EC2

Замечу, что мы по максимуму будем использовать free tier - бесплатные услуги от AWS. Не все элементы стэка бесплатны (взять хотя бы покупку домена), но в рамках данного туториала нам этого вполне хватит.

![Stack visualisation](/img/2021-03/aws_iam/stack_diagram.png){: .center-image }

## AWS iAM

Для начала начнём с самого простого - iAM. В строке поиска введите iAM, сервис должен появиться первый в списке.
![IAM Selection](/img/2021-03/aws_iam/iam_selection.png){: .center-image }

Примем за исходные данные, что вы уже зарегестрировались и вошли в рутовую учётную запись. Amazon не рекомендует использовать её никак, помимо первичной настройки и задании доступов. Поэтому сразу создадим учётную запись администратора, которую и будем использовать для всей последующей работы внутри AWS.

AWS iAM состоит из 4 основных частей:
1. Policies
2. Roles
3. Users
4. Groups

Такое количество сделано для удобного управления большим количеством пользователей. Например, вместо пересоздания пользователя, когда хочется изменить его доступ к чему-либо, можно просто удалить Policy у пользователя. Для начала таки создадим администратора. Этого нам хватит.

![IAM Groups](/img/2021-03/aws_iam/group_tab.png){: .center-image }

Нажимаем "Create New Group", затем вводим название, например, "Administrators". На этапе выбора политик выбираем `AdministratorAccess`.

![IAM Admin access](/img/2021-03/aws_iam/admin_access.png){: .center-image }

Затем нажимаем "Create Group". Мы создали группу администраторов, в которую нужно добавить новго пользователя. 

Переходим на вкладку "Users" и нажимаем "Add User". Задаём имя, например, Admin. Затем выбираем оба уровня доступа (Programmatic access и AWS Management Console access), создаём пароль.

![IAM Create user](/img/2021-03/aws_iam/add_user.png){: .center-image }

После переходим во вкладку Permissions и выбираем созданную нами группу администраторов. 

Нажимаем далее, оставляем тэги пустыми, создаём роль и на экране созданной роли нужно ОБЯЗАТЕЛЬНО скопировать и сохранить `Access key ID` и `Secret access key` для последующего использования роли из консоли.

Отлично, мы создали пользователя. Теперь нам нужно открыть профиль и посмотреть номер аккаунта. На момент написания статьи достаточно ткнуть по профилю в правом верхнем углу и посмотреть номер. Амазон периодически меняет дизайн, так что этом может поменяться.

![IAM Create user](/img/2021-03/aws_iam/account_number.png){: .center-image }

Теперь выходим из своего основного аккаунта, затем заходим за новосозданного администратора и для всех дальнейших манипуляций с AWS используем именно администратора.
В дальнейшем для некоторых целей, например, для доступа из EC2 машины к хранилищу контейнеров ECR понадобится создавать дополнительные роли, чтобы не хранить креды администратора на виртуальной машине.

## Ссылки

1. (Документация на AWS)[https://docs.aws.amazon.com/rekognition/latest/dg/setting-up.html]
2. (Много полезных видео от Amazon)[https://aws.amazon.com/iam/getting-started/]

### Послесловие
Автор является новичком в backend разработки и делится своим опытом после чтения документации, просмотра видео и после как успешных, так и не очень попыток поднять свой сервер. Автор отдаёт себе отчёт, что некоторые вещи могут быть сделаны проще. Цикл статей будет являться пошаговым визуальным туториалом для новичков. Если вы заметили какие-то неточности или ошибки, пишите в сообщения ниже или в [DM твиттера](https://twitter.com/NikitkaPa).